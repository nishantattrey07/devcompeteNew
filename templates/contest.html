{% extends "base.html" %}
{% block main %}
<div>

    {{ problem.name }}
    <div id="editor">code</div>

    <button class="btn btn-primary" id="run_btn">Run Code</button>

    <div>
        <h3 class="text-2xl">Output</h3>
        <div id="output"></div>
    </div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reconnecting-websocket/1.0.0/reconnecting-websocket.min.js" integrity="sha512-B4skI5FiLurS86aioJx9VfozI1wjqrn6aTdJH+YQUmCZum/ZibPBTX55k5d9XM6EsKePDInkLVrN7vPmJxc1qA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/python");

    var submit_btn = document.getElementById("run_btn");
    submit_btn.addEventListener("click", function() {
        var code = editor.getValue();
        var output = document.getElementById("output");
        output.innerHTML = "Running...";
        FormData = {
            "source_code": code
        }
        var response = fetch("./", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify(FormData),
        }).then(function(response) {
            return response.json();
        }).then(function(data) {
            output.innerHTML = data.output;
        });
    });

    {% comment %} connect to WebSocket {% endcomment %}

    var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
    var ws_path = ws_scheme + '://' + window.location.host + "/ws/chat/{{ contest.id }}/";

    var socket = new ReconnectingWebSocket(ws_path);

    socket.onopen = function() {
        console.log("Connected to chat socket");
    };

    socket.onmessage = function(message) {
        // var data = JSON.parse(message.data);
        console.log(message["data"]);
    };

    editor.on("change", function() {
        var code = editor.getValue();
        socket.send(JSON.stringify({
            "code": code
        }));
    });

</script>
<style>
#editor {
    position: relative;
    width: 500px;
    height: 400px;
}
</style>
{% endblock main %}

